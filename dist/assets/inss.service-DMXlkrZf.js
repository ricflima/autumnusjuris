var p=Object.defineProperty;var f=(u,a,t)=>a in u?p(u,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):u[a]=t;var l=(u,a,t)=>f(u,typeof a!="symbol"?a+"":a,t);import{R as x,l as d}from"./realTribunalClient.service-CebukglM.js";import"./index-D82AO8B3.js";class b{constructor(){l(this,"client");this.client=new x({baseURL:"https://meu.inss.gov.br",timeout:6e4,rateLimitDelay:3e3,retryAttempts:3,userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",enableCookies:!0})}async consultarProcesso(a,t){try{const e=await this.client.makeRequest({method:"GET",url:"/portal/login"}),o=await this.client.makeRequest({method:"GET",url:`/dataprev/ConsultaProcesso?numero=${a}&cpf=${t}`});return this.parseProcessINSS(o.data,a)}catch(e){throw new Error(`Erro na consulta INSS: ${e instanceof Error?e.message:"Erro desconhecido"}`)}}async consultarBeneficios(a,t){try{const e=await this.client.makeRequest({method:"POST",url:"/portal/beneficio/consulta",data:new URLSearchParams({cpf:a,nit:t||"",consulta:"beneficios"}),headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"}});return this.parseBeneficiosINSS(e.data)}catch(e){throw new Error(`Erro na consulta de benefícios: ${e instanceof Error?e.message:"Erro desconhecido"}`)}}async consultarExtratoContribuicoes(a){try{const t=await this.client.makeRequest({method:"GET",url:`/cnis/extrato?cpf=${a}`}),e=d(t.data),o=[];return e(".extrato-contribuicao tr").each((n,i)=>{const s=e(i).find("td");s.length>=4&&o.push({competencia:s.eq(0).text().trim(),salarioContribuicao:this.parseValor(s.eq(1).text().trim()),empresa:s.eq(2).text().trim(),situacao:s.eq(3).text().trim()})}),o}catch(t){throw new Error(`Erro na consulta de contribuições: ${t instanceof Error?t.message:"Erro desconhecido"}`)}}async consultarCarencia(a){try{const t=await this.client.makeRequest({method:"GET",url:`/carencia/consulta?cpf=${a}`}),e=d(t.data);return{carenciaAposentadoria:this.extractNumber(e(".carencia-aposentadoria").text()),carenciaAuxilioDoenca:this.extractNumber(e(".carencia-auxilio").text()),tempoContribuicao:this.extractNumber(e(".tempo-contribuicao").text()),proximaRevisao:this.parseDate(e(".proxima-revisao").text())}}catch(t){throw new Error(`Erro na consulta de carência: ${t instanceof Error?t.message:"Erro desconhecido"}`)}}async consultarRequerimentos(a){try{const t=await this.client.makeRequest({method:"GET",url:`/requerimentos/consulta?cpf=${a}`}),e=d(t.data),o=[];return e(".requerimento-item").each((n,i)=>{const r=e(i),s={numero:r.find(".numero-requerimento").text().trim(),classe:"Requerimento Administrativo",assunto:r.find(".tipo-beneficio").text().trim(),dataAjuizamento:this.parseDate(r.find(".data-protocolo").text().trim()),situacao:r.find(".situacao-requerimento").text().trim(),localizacao:"INSS",orgaoJulgador:"Instituto Nacional do Seguro Social",partes:[{nome:"Segurado",tipo:"autor",documento:a}],advogados:[],movimentacoes:this.extractMovimentacoesRequerimento(r),audiencias:[],documentos:[],recursos:[]};o.push(s)}),o}catch(t){throw new Error(`Erro na consulta de requerimentos: ${t instanceof Error?t.message:"Erro desconhecido"}`)}}async consultarPericia(a){try{const t=await this.client.makeRequest({method:"GET",url:`/pericia/consulta?cpf=${a}`}),e=d(t.data),o=[];return e(".pericia-agendada").each((n,i)=>{const r=e(i);o.push({numeroRequerimento:r.find(".numero-req").text().trim(),dataPericia:this.parseDate(r.find(".data-pericia").text().trim()),horaPericia:r.find(".hora-pericia").text().trim(),localPericia:r.find(".local-pericia").text().trim(),tipoPericia:r.find(".tipo-pericia").text().trim(),medicoPeritoResponsavel:r.find(".medico-perito").text().trim()})}),o}catch(t){throw new Error(`Erro na consulta de perícia: ${t instanceof Error?t.message:"Erro desconhecido"}`)}}parseProcessINSS(a,t){const e=d(a);if(e(".erro-consulta").length>0||e('span:contains("não foi encontrado")').length>0)throw new Error("Processo não encontrado no INSS");const o={numero:t,classe:"Processo Administrativo",assunto:"",dataAjuizamento:"",situacao:"Em andamento",localizacao:"INSS",orgaoJulgador:"Instituto Nacional do Seguro Social",partes:[],advogados:[],movimentacoes:[],audiencias:[],documentos:[],recursos:[]};return e(".dados-processo tr, .info-requerimento tr").each((n,i)=>{const r=e(i),s=r.find("td:first-child, th:first-child").text().trim().toLowerCase(),c=r.find("td:last-child").text().trim();switch(s){case"situação":case"status":o.situacao=c;break;case"assunto":case"tipo de benefício":case"espécie":o.assunto=c;break;case"data de protocolo":case"data protocolização":o.dataAjuizamento=this.parseDate(c);break;case"órgão":case"unidade protocolizadora":o.orgaoJulgador=c,o.localizacao=c;break;case"interessado":case"segurado":o.partes.push({nome:c,tipo:"autor",documento:this.extractCPF(c)});break}}),o.movimentacoes=this.extractMovimentacoesINSS(e),o}parseBeneficiosINSS(a){const t=d(a),e=[];return t(".beneficio-item, .lista-beneficios tr").each((o,n)=>{const i=t(n);if(i.find("th").length>0)return;const r=i.find(".numero-beneficio, td:nth-child(1)").text().trim();r&&e.push({numeroProcesso:"",numerobeneficio:r,situacao:i.find(".situacao-beneficio, td:nth-child(2)").text().trim(),especieBeneficio:i.find(".especie-beneficio, td:nth-child(3)").text().trim(),dataInicio:this.parseDate(i.find(".data-inicio, td:nth-child(4)").text().trim()),dataFim:this.parseDate(i.find(".data-fim, td:nth-child(5)").text().trim())||void 0,valorRenda:this.parseValor(i.find(".valor-renda, td:nth-child(6)").text().trim())})}),e}extractMovimentacoesINSS(a){const t=[];return a(".historico-processo tr, .movimentacoes-inss tr, .timeline-inss .evento").each((e,o)=>{const n=a(o),i=n.find("td");if(i.length>=2){const c=i.eq(0).text().trim(),m=i.eq(1).text().trim(),h=i.length>2?i.eq(2).text().trim():"INSS";c&&m&&this.isValidDate(c)&&t.push({id:`inss-mov-${e}`,data:this.parseDate(c),titulo:this.extractTitulo(m),descricao:`${m} - Órgão: ${h}`,oficial:!0})}const r=n.find(".data-evento").text().trim(),s=n.find(".descricao-evento").text().trim();r&&s&&this.isValidDate(r)&&t.push({id:`inss-mov-${e}`,data:this.parseDate(r),titulo:this.extractTitulo(s),descricao:s,oficial:!0})}),t.sort((e,o)=>new Date(o.data).getTime()-new Date(e.data).getTime())}extractMovimentacoesRequerimento(a){const t=[];return a.find(".historico-req .movimento").each((e,o)=>{const n=$(o),i=n.find(".data").text().trim(),r=n.find(".descricao").text().trim();i&&r&&this.isValidDate(i)&&t.push({id:`inss-req-${e}`,data:this.parseDate(i),titulo:this.extractTitulo(r),descricao:r,oficial:!0})}),t}async consultarAgendamentos(a,t){try{const e=await this.client.makeRequest({method:"GET",url:`/agendamento/disponibilidade?cpf=${a}&servico=${t}`}),o=d(e.data),n=[];return o(".agenda-disponivel").each((i,r)=>{const s=o(r);n.push({data:this.parseDate(s.find(".data-agenda").text().trim()),hora:s.find(".hora-agenda").text().trim(),unidade:s.find(".unidade-agenda").text().trim(),endereco:s.find(".endereco-agenda").text().trim(),telefone:s.find(".telefone-agenda").text().trim()})}),n}catch(e){throw new Error(`Erro na consulta de agendamentos: ${e instanceof Error?e.message:"Erro desconhecido"}`)}}parseDate(a){if(!a)return"";const t=a.match(/(\d{1,2})\/(\d{1,2})\/(\d{4})/);if(t){const[,e,o,n]=t;return`${n}-${o.padStart(2,"0")}-${e.padStart(2,"0")}`}return""}parseValor(a){return a&&parseFloat(a.replace(/[^\d,]/g,"").replace(",","."))||0}isValidDate(a){return!!a.match(/\d{1,2}\/\d{1,2}\/\d{4}/)}extractTitulo(a){let e=a.split(`
`)[0].trim();return e.length>100&&(e=e.substring(0,100)+"..."),e||"Movimentação INSS"}extractCPF(a){const t=a.match(/\d{3}\.?\d{3}\.?\d{3}-?\d{2}/);return t?t[0]:void 0}extractNumber(a){const t=a.match(/\d+/);return t?parseInt(t[0],10):0}async verificarDisponibilidade(){try{return(await this.client.makeRequest({method:"GET",url:"/",timeout:1e4})).status===200}catch{return!1}}async cleanup(){await this.client.cleanup()}}export{b as INSSService};
