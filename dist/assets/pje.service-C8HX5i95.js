var v=Object.defineProperty;var w=(l,t,a)=>t in l?v(l,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):l[t]=a;var p=(l,t,a)=>w(l,typeof t!="symbol"?t+"":t,a);import{R as T,l as h}from"./realTribunalClient.service-CebukglM.js";import"./index-D82AO8B3.js";class u{constructor(t){p(this,"client");p(this,"config");this.config=t,this.client=new T({baseURL:t.baseUrl,timeout:45e3,rateLimitDelay:3e3,retryAttempts:5,userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",enableCookies:!0})}async consultarProcesso(t){try{return this.config.requiresCertificate?await this.consultarComCertificado(t):await this.consultarPublica(t)}catch(a){throw new Error(`Erro na consulta PJe ${this.config.tribunal}: ${a instanceof Error?a.message:"Erro desconhecido"}`)}}async consultarPublica(t){const a="/pje/ConsultaPublica/listView.seam",e=await this.client.makeRequest({method:"GET",url:a}),r=h(e.data),i=r('input[name="javax.faces.ViewState"]').val()||"",o=r('input[name="javax.faces.WindowId"]').val()||"",s=r(".ui-form").attr("id")||"formConsultaPublica",n=t.replace(/\D/g,""),c=n.substring(0,7),d=n.substring(7,9),m=n.substring(9,13),j=n.substring(13,14),b=n.substring(14,16),f=n.substring(16,20),g=new URLSearchParams({[s]:s,[`${s}:numeroSequencial`]:c,[`${s}:digitoVerificador`]:d,[`${s}:anoAjuizamento`]:m,[`${s}:orgaoJudiciario`]:j,[`${s}:tribunal`]:b,[`${s}:orgaoOrigem`]:f,[`${s}:botaoConsultarProcessos`]:"Consultar","javax.faces.ViewState":i,"javax.faces.WindowId":o}),x=await this.client.makeRequest({method:"POST",url:a,data:g,headers:{"Content-Type":"application/x-www-form-urlencoded","Faces-Request":"partial/ajax","X-Requested-With":"XMLHttpRequest"}});return this.parseProcessData(x.data,t)}async consultarComCertificado(t){const e=await this.client.makeRequest({method:"GET",url:"/pje/Processo/ConsultaProcesso/listView.seam"});return this.parseProcessData(e.data,t)}parseProcessData(t,a){const e=h(t);if(e(".mensagem-erro, .ui-messages-error").length>0)throw new Error(`Processo não encontrado no ${this.config.tribunal}`);const r={numero:a,classe:"",assunto:"",dataAjuizamento:"",situacao:"Em andamento",localizacao:"",orgaoJulgador:"",partes:[],advogados:[],movimentacoes:[],audiencias:[],documentos:[],recursos:[]};r.classe=this.extractValue(e,"Classe")||"Não informado",r.assunto=this.extractValue(e,"Assunto")||"Não informado",r.orgaoJulgador=this.extractValue(e,"Órgão julgador")||this.extractValue(e,"Vara")||this.extractValue(e,"Juízo")||"Não informado";const i=this.extractValue(e,"Data de autuação")||this.extractValue(e,"Distribuição");i&&(r.dataAjuizamento=this.parseDate(i));const o=this.extractValue(e,"Valor da causa");o&&(r.valorCausa=this.parseValor(o)),r.magistrado=this.extractValue(e,"Magistrado")||this.extractValue(e,"Juiz")||this.extractValue(e,"Relator"),r.partes=this.extractPartes(e),r.advogados=this.extractAdvogados(e),r.movimentacoes=this.extractMovimentacoes(e),r.audiencias=this.extractAudiencias(e),r.localizacao=r.orgaoJulgador;const s=r.movimentacoes[0];if(s){r.ultimaMovimentacao=s.data;const n=s.descricao.toLowerCase();n.includes("sentença")||n.includes("julgado")?r.situacao="Julgado":n.includes("arquivado")?r.situacao="Arquivado":n.includes("suspen")&&(r.situacao="Suspenso")}return r}extractValue(t,a){let e="";return t(`.detail-row .label:contains("${a}")`,".detail-row").next(".value").each((r,i)=>{e=t(i).text().trim()}),t(`td:contains("${a}")`,"table").next("td").each((r,i)=>{e||(e=t(i).text().trim())}),t(`.info-process span:contains("${a}")`).each((r,i)=>{const s=t(i).parent().text().match(new RegExp(`${a}:?\\s*([^\\n]+)`));s&&!e&&(e=s[1].trim())}),e}extractPartes(t){const a=[];return t(".partes-processo .parte, .party-info, .processo-parte").each((e,r)=>{const i=t(r),o=i.find(".tipo-parte, .party-type").text().trim().toLowerCase(),s=i.find(".nome-parte, .party-name").text().trim();if(s){let n="outros";o.includes("autor")||o.includes("requerente")||o.includes("impetrante")?n="autor":o.includes("réu")||o.includes("requerido")||o.includes("impetrado")?n="reu":o.includes("terceiro")&&(n="terceiro"),a.push({nome:s,tipo:n,documento:this.extractDocumento(s)})}}),a.length===0&&t("table tr").each((e,r)=>{const o=t(r).find("td");if(o.length>=2){const s=o.eq(0).text().trim().toLowerCase(),n=o.eq(1).text().trim();if(n&&(s.includes("autor")||s.includes("réu"))){const c=s.includes("autor")?"autor":"reu";a.push({nome:n,tipo:c,documento:this.extractDocumento(n)})}}}),a}extractAdvogados(t){const a=[];return t(".advogado-info, .lawyer-info").each((e,r)=>{const i=t(r).text(),o=i.match(/OAB[\/\s]*([A-Z]{2})[\/\s]*(\d+)/i);if(o){const s=i.replace(/OAB[\/\s]*[A-Z]{2}[\/\s]*\d+/i,"").trim();a.push({nome:s,oab:o[2],uf:o[1],tipo:"parte_autora",ativo:!0})}}),a}extractMovimentacoes(t){const a=[];return t(".movimentacao, .movement-item, .timeline-item").each((e,r)=>{const i=t(r),o=i.find(".data-movimentacao, .movement-date, .date").text().trim(),s=i.find(".descricao-movimentacao, .movement-description, .description").text().trim();if(o&&s){const n=this.parseDate(o),c=o.match(/(\d{2}:\d{2})/);a.push({id:`pje-mov-${e}`,data:n,dataHora:c?`${n}T${c[1]}:00`:void 0,titulo:this.extractTitulo(s),descricao:s.trim(),oficial:!0})}}),a.sort((e,r)=>new Date(r.data).getTime()-new Date(e.data).getTime())}extractAudiencias(t){const a=[];return t(".audiencia, .hearing-info").each((e,r)=>{const i=t(r),o=i.find(".data-audiencia, .hearing-date").text().trim(),s=i.find(".tipo-audiencia, .hearing-type").text().trim(),n=i.find(".local-audiencia, .hearing-location").text().trim();if(o){const c=this.parseDate(o),d=o.match(/(\d{2}:\d{2})/);a.push({id:`pje-aud-${e}`,data:c,hora:d?d[1]:"09:00",tipo:s||"Não especificado",situacao:"agendada",local:n||"Não informado"})}}),a}parseDate(t){const a=t.match(/(\d{1,2})\/(\d{1,2})\/(\d{4})/);if(a){const[,r,i,o]=a;return`${o}-${i.padStart(2,"0")}-${r.padStart(2,"0")}`}const e=t.match(/(\d{4}-\d{2}-\d{2})/);return e?e[1]:new Date().toISOString().split("T")[0]}parseValor(t){const a=t.replace(/[^\d,]/g,"").replace(",",".");return parseFloat(a)||0}extractTitulo(t){let e=t.split(`
`)[0].trim();return e.length>150&&(e=e.substring(0,150)+"..."),e||"Movimentação processual"}extractDocumento(t){const a=t.match(/\d{3}\.?\d{3}\.?\d{3}-?\d{2}/);if(a)return a[0];const e=t.match(/\d{2}\.?\d{3}\.?\d{3}\/?\d{4}-?\d{2}/);if(e)return e[0]}async verificarDisponibilidade(){try{const t=await this.client.makeRequest({method:"GET",url:"/pje/ConsultaPublica/listView.seam",timeout:1e4});return t.status===200&&t.data.includes("Consulta Pública")}catch{return!1}}async cleanup(){await this.client.cleanup()}}class S{static createTRF1Service(){return new u({baseUrl:"https://pje1g.trf1.jus.br",tribunal:"TRF1",grau:"1"})}static createTRF2Service(){return new u({baseUrl:"https://pje.trf2.jus.br",tribunal:"TRF2",grau:"1"})}static createTRF3Service(){return new u({baseUrl:"https://pje1g.trf3.jus.br",tribunal:"TRF3",grau:"1"})}static createTRF4Service(){return new u({baseUrl:"https://pje1g.trf4.jus.br",tribunal:"TRF4",grau:"1"})}static createTRF5Service(){return new u({baseUrl:"https://pje1g.trf5.jus.br",tribunal:"TRF5",grau:"1"})}static createTRF6Service(){return new u({baseUrl:"https://pje1g.trf6.jus.br",tribunal:"TRF6",grau:"1"})}static createTSTService(){return new u({baseUrl:"https://pje.tst.jus.br",tribunal:"TST",grau:"1",requiresCertificate:!0})}static createTRTService(t){const a={"01":"https://pje.trt1.jus.br","02":"https://pje.trt2.jus.br","03":"https://pje.trt3.jus.br","04":"https://pje.trt4.jus.br","05":"https://pje.trt5.jus.br","06":"https://pje.trt6.jus.br","07":"https://pje.trt7.jus.br","08":"https://pje.trt8.jus.br","09":"https://pje.trt9.jus.br",10:"https://pje.trt10.jus.br",11:"https://pje.trt11.jus.br",12:"https://pje.trt12.jus.br",13:"https://pje.trt13.jus.br",14:"https://pje.trt14.jus.br",15:"https://pje.trt15.jus.br",16:"https://pje.trt16.jus.br",17:"https://pje.trt17.jus.br",18:"https://pje.trt18.jus.br",19:"https://pje.trt19.jus.br",20:"https://pje.trt20.jus.br",21:"https://pje.trt21.jus.br",22:"https://pje.trt22.jus.br",23:"https://pje.trt23.jus.br",24:"https://pje.trt24.jus.br"};return new u({baseUrl:a[t]||`https://pje.trt${t}.jus.br`,tribunal:`TRT${t}`,grau:"1"})}}export{S as PJeFactory,u as PJeService};
